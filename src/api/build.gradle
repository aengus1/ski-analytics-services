
plugins {
    id 'scala'
    id 'java'
}


dependencies {
    compile (
            'org.scala-lang:scala-library:2.11.12',
            'com.amazonaws:aws-lambda-java-core:1.1.0',
            'com.amazonaws:aws-java-sdk-s3:1.11.409',
            'com.amazonaws:aws-java-sdk-dynamodb:1.11.166',
            'com.amazonaws:aws-java-sdk-cloudformation:1.11.166',
            'com.amazonaws:aws-java-sdk-cognitoidp:1.11.442',
            'com.amazonaws:aws-java-sdk-ssm:1.11.500',
            'com.amazonaws:aws-lambda-java-log4j:1.0.0',
            'com.fasterxml.jackson.core:jackson-core:2.8.5',
            'com.fasterxml.jackson.core:jackson-databind:2.8.5',
            'com.fasterxml.jackson.core:jackson-annotations:2.8.5',
            'com.google.protobuf:protobuf-java:3.5.0',
            'commons-io:commons-io:2.5',
            "com.vividsolutions:jts:1.13",
            "org.geotools:gt-main:16.1",
            "org.geotools:gt-epsg-hsql:16.1",

    )
    testImplementation(
            'org.scalatest:scalatest_2.11:3.0.0',
            'org.junit.jupiter:junit-jupiter-api:5.1.0',
            // https://mvnrepository.com/artifact/com.sun.jersey/jersey-client
            'org.glassfish.jersey.core:jersey-client:2.5.1',
            'com.fasterxml.jackson.core:jackson-core:2.9.7',
            'org.mockito:mockito-all:1.10.19'


    )
    testRuntimeOnly(
            'org.junit.jupiter:junit-jupiter-engine:5.1.0'
    )
}

test {
    useJUnitPlatform()

    // explicitly include or exclude tests
    include 'ski/crunch/**'


    // show standard out and standard error of the test JVM(s) on the console
    testLogging.showStandardStreams = true

    // set heap size for the test JVM(s)
    minHeapSize = "128m"
    maxHeapSize = "512m"

    // set JVM arguments for the test JVM(s)
    jvmArgs '-XX:MaxPermSize=256m'

    // listen to events in the test execution lifecycle
    beforeTest { descriptor ->
        logger.lifecycle("Running test: " + descriptor)
    }

    // Fail the 'test' task on the first test failure
    failFast = true

    // listen to standard out and standard error of the test JVM(s)
    onOutput { descriptor, event ->
        logger.lifecycle("Test: " + descriptor + " produced standard out/err: " + event.message )
    }
}

sourceSets {
    main {
        scala {
            srcDirs = ['src/main/scala', 'src/main/java']
        }
        java {
            srcDirs = []
        }
    }
}

task buildZip(type: Zip) {
    baseName = "api"
    from compileJava
    from compileScala
    from processResources
    into('lib') {
        from configurations.runtime
    }
}

build.dependsOn buildZip

task wrapper(type: Wrapper) {
    gradleVersion = '3.5'
}